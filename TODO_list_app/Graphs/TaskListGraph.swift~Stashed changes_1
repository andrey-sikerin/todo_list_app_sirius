//
//  TaskListGraph.swift
//  TODO_list_app
//
//  Created by Artem Goldenberg on 11.12.2021.
//

import Foundation
import UIKit

class TaskListGraph {
    private(set) var viewController: UIViewController
    private var tasks: FileCache = FileCache.test
    private var currentEdit: EditTaskGraph?
    
    init() {
        let transitionToEditVC: (IndexPath) -> Void = { [weak self] index in
            let editTaskVC = EditTaskViewController(strings: EditTaskViewController.Strings(
                leftNavigationBarText: NSLocalizedString("Cancel", comment: ""),
                rightNavigationBarText: NSLocalizedString("Save", comment: ""),
                titleNavigationBarText: NSLocalizedString("Task", comment: "")
            ))
            self?.viewController.navigationController?.pushViewController(editTaskVC, animated: true)
        }
        self.viewController = TaskListViewController(transitionToEdit: transitionToEditVC)
    }
}

fileprivate func getDocumentsDirectory() -> URL? {
    let paths = FileManager.default.urls(for: .documentDirectory, in: .userDomainMask)
    return paths.first
}

fileprivate extension FileCache {
    static var test: FileCache = {
        let manager = FileCache.FileManager(write: { data, url in
            try data.write(to: url)
        }, read: { url in
            try Data(contentsOf: url)
        })
        let file = FileCache(manager: manager)
        let buyFood = TodoItem(id: "BuyFoodIdString", text: "Working for food", priority: .low)
        let goRun = TodoItem(text: "Running is good", priority: .normal)
        let homework = TodoItem(text: "Copy It", deadline: Date().addingTimeInterval(3600), priority: .high)
        let cookLunch = TodoItem(text: "Cook yourself!", priority: .normal)
        let eatLunch = TodoItem(text: "Enjoy", priority: .normal)
        let goSleep = TodoItem(text: "Sleeping is essential", deadline: Date().addingTimeInterval(3600 * 5), priority: .high)
        file.addTask(buyFood)
        file.addTask(goRun)
        file.addTask(homework)
        file.addTask(cookLunch)
        file.addTask(eatLunch)
        file.addTask(goSleep)
        return file
    }()
}
