# TODO List

[Макеты](https://www.figma.com/file/gugusDLUlvMczCSDXSzpTa/Сделать---app-design?node-id=0%3A1) в Figma

Набросок:
![](todoapp.png)

# Модельки

1. Список дел. Содержит набор (упорядоченный) дел (описание ниже, далее "Дело")
1. Дело. Единица, содержит метаинформацию об одном деле
1. Текст (по длине не ограничен, на первом экране максимум 3 строки, дальше "...")
1. Важность - одно из трех значения "низкая", "обычная", "срочная"
1. Дедлайн, может отсутствовать, если присутствует должна быть дата дедлайна
1. Дата Дедлайна, дата (без времени), присутствует если установлен флаг дедлайна
1. Флаг сделанность, установлен если дело считается сделанным
1. Дата последнего изменения (unix timestamp, будет нужен для синхронизации с бэкендом)

# Экраны

## Главный экран

Содержит шапку, в которой есть тайтл "Сделать!" (возможны вариации) и два действия:

1. Скрыть сделанные дела
1. Добавить новое дело

При тапе не шапку возвращаемся вверх списка

Список содержит ячейки дел, обрамленные сверху и снизу кнопками, позволяющие добавить новое дело.

Ячейка состоит из трех элементов:

1. Кружочек (или другой элемент, обозначающий то же самое) отображающий флаг сделанности дела
1. Текст дела, максимум 3 строки
1. Индикатор вправа (или другой элемент обозначающий наличие действия)

У ячейки должны быть side action'ы (не знаю насчет Android тут):

1. Слева - позволяющее переключать флаг сделанности
1. Справа - действие редактирования и действие удаления дела

Быстрый свайп вправо переключает флаг сделанности
Истекщий дедлайн красит ячейку в красный

При тапе на "добавить новое дело", при тапе на правую часть ячейки дела (там где нет индикатора сделанности) или при использовании side action редактировать - открываем редактор

## Редактор

Содержит шапку, в которой есть кнопка назад, текст "Редактор дела" и две кнопки - "удалить" и "сохранить".

Далее скролл вью, в котором элементы редактирования дела

1. Редактор текста - расширяется/сжимается вместе с текстом, показывает весь текст, сколь бы длинным он не был
1. Лейбл и элемент переключения для редактирования важности
1. Лейбл дедлайна с тогглом, который включает дедлайн и отображает пикер (или календарик) для выбора даты дедлайна

Следует правильно обрабатывать клавиатуру, ее появление не должно мешать редактированию полей.

# Описание бэкенда

Базовый урл в примерах: http://domain/

Реальный урл: https://d5dps3h13rv6902lp5c8.apigw.yandexcloud.net

## Авторизация

Реализован простой вариант с Bearer, токен получать у организаторов курса

Header: `Authorization: Bearer <token>`

## Ручки

При отправке данных в формате json (методы `PUT`, `POST`) требуется добавлять заголовок `Content-Type: application/json`

### Формат элемента

```
{
  "id": <uuid>, // уникальный идентификатор элемента
  "text": "blablabla",
  "importance": "<importance>", // importance = low | basic | important
  "deadline": <unix timestamp>, // int64, может отсутствовать, тогда нет
  "done": <bool>,
  "created_at": <unix timestamp>,
  "updated_at": <unix timestamp>
}
```

### Получить список с сервера

`GET http://domain/tasks`

Ответ:
```
[
  {<task>},
  ...
]
```

### Обновить список на сервере

`PUT http://domain/tasks`

Запрос:
```
{
  "deleted": [<id1>, <id2>, ...],
  "other": [{<task>}, {<task>}, ...]
}
```
[Формат элементов](#формат-элемента)

Ответ: [формат](#получить-список-с-сервера)

**Важно** - мердж данных делает сервер, результат возвращается уже смердженным. Мердж сервером делается по "last write wins" по каждому конкретному элементу списка

### Добавить элемент списка

`POST http://domain/tasks`

Формат запроса: см. [формат элемента](#формат-элемента)

Формат ответа (см. там же) - выводится созданный элемент

### Изменить элемент списка

`PUT http://domain/tasks/<id>`

Формат запроса: см. [формат элемента](#формат-элемента)

Формат ответа (см. там же) - выводится измененный элемент

Может вернуть 404, если элемента нет

### Удалить элемент списка

`DELETE http://domain/tasks/<id>`

Формат ответа см. [формат элемента](#формат-элемента) - возвращается удаленный элемент

Может вернуть 404, если элемента нет

### Формат ошибок

4xx, 5xx могут возвращаться (а могут и не возвращаться, будьте осторожны) в следующем формате:

```
{
  "message": "<тестовое описание ошибки>"
}
```

### Отладка

Для отладки на начальных этапах удобно использовать curl, например:
```
# Получение списка
curl --header "Authorization: Bearer <token>" https://domain/tasks

# Добавление элемента, json в файле task.txt
# -i выводит дополнительную информацию, в частности код HTTP-ответа
curl -X POST --header "Authorization: Bearer <token>" --header "Content-Type: application/json" -d "@task.txt" -i https://domain/tasks

# Удаление элемента
curl -X DELETE --header "Authorization: Bearer <token>" https://domain/tasks/<id>
```
